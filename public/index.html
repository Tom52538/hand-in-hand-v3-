<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/Hand-in-Hand-Logo-192x192.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/Hand-in-Hand-Logo-192x192.png" />
  <link rel="shortcut icon" href="/icons/Hand-in-Hand-Logo-192x192.png" />
  <link rel="manifest" href="/icons/manifest.json" />
  <title>Arbeitszeiterfassung</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="theme-color" content="#ffffff" />
  <style>
    /* Grundlegende Stile */
    .hidden { display: none; }
    form > div { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 8px; vertical-align: middle; text-align: left; }
    td button { margin-right: 5px; padding: 5px 10px; }
    .table-wrapper { overflow-x: auto; }
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1, h2, h3 { color: #333; }
    button { padding: 10px 15px; cursor: pointer; }
    button:disabled { cursor: not-allowed; opacity: 0.6; }
    hr { margin: 2rem 0; border: 0; border-top: 1px solid #eee; }
    input[readonly] { background-color: #e9e9e9; cursor: default; }
    /* Tab-Navigation-Stile (wird in Teil 2 weiter genutzt) */
    .tabs {
      list-style: none;
      padding: 0;
      margin: 0 0 1rem 0;
      display: flex;
      border-bottom: 1px solid #ccc;
    }
    .tabs li {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-bottom: none;
      margin-right: 5px;
      background: #f1f1f1;
    }
    .tabs li.active {
      background: #fff;
      font-weight: bold;
    }
    .tab-content {
      border: 1px solid #ccc;
      padding: 20px;
      background: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Arbeitszeiterfassung</h1>

    <!-- Zeiterfassungsformular -->
    <form id="workHoursForm">
      <div>
        <label for="employeeSelect">Mitarbeiter:</label>
        <select id="employeeSelect" name="employeeSelect" required>
          <option value="">Bitte auswählen</option>
        </select>
      </div>
      <div>
        <label for="selectedEmployeeDisplay">Ausgewählter Mitarbeiter:</label>
        <input type="text" id="selectedEmployeeDisplay" name="selectedEmployeeDisplay" readonly disabled value="Kein Mitarbeiter ausgewählt" />
      </div>
      <div>
        <button type="button" id="workTimeBtn">Arbeitsbeginn buchen</button>
      </div>
      <div class="hidden">
        <button type="button" id="pauseBtn">Pausen buchen</button>
      </div>
      <div>
        <label for="date">Datum:</label>
        <input type="date" id="date" name="date" required readonly />
      </div>
      <div>
        <label for="startTime">Arbeitsbeginn:</label>
        <input type="time" id="startTime" name="startTime" required readonly />
      </div>
      <div>
        <label for="endTime">Arbeitsende:</label>
        <input type="time" id="endTime" name="endTime" required readonly />
      </div>
      <div>
        <label for="breakTime">Pause (Minuten):</label>
        <input type="number" id="breakTime" name="breakTime" min="0" step="1" value="0" required disabled />
      </div>
      <div>
        <label for="comment">Bemerkungen:</label>
        <input type="text" id="comment" name="comment" disabled/>
      </div>
    </form>

    <hr>
    <h2>Gebuchte Arbeitszeiten</h2>
    <ul id="workHoursList"></ul>
    <h2>Gesamtarbeitszeit</h2>
    <p id="totalHours"></p>
    <hr>

    <!-- Admin Login -->
    <h2>Admin Login</h2>
    <form id="adminLoginForm">
      <div>
        <label for="adminPassword">Passwort:</label>
        <input type="password" id="adminPassword" name="adminPassword" required />
      </div>
      <button type="submit">Anmelden</button>
    </form>
    <!-- Tab-basierter Admin-Bereich -->
    <div id="adminTabs" class="hidden">
      <ul class="tabs">
        <li data-tab="dashboard" class="active">Dashboard/Home</li>
        <li data-tab="workhours">Arbeitszeiten</li>
        <li data-tab="employees">Mitarbeiterverwaltung</li>
        <li data-tab="monthly">Monatsauswertung</li>
      </ul>

      <!-- Tab: Dashboard/Home -->
      <div id="tab-dashboard" class="tab-content">
        <h2>Dashboard/Home</h2>
        <p>Hier erscheinen aktuelle Kennzahlen und Benachrichtigungen (Platzhaltertext).</p>
      </div>

      <!-- Tab: Arbeitszeiten -->
      <div id="tab-workhours" class="tab-content hidden">
        <h2>Arbeitszeiten</h2>
        <div class="table-wrapper">
          <table id="workHoursTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Datum</th>
                <th>Arbeitszeit</th>
                <th>Stunden</th>
                <th>Pause (Min)</th>
                <th>Bemerkungen</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <br>
        <button id="adminDownloadCsv">CSV herunterladen</button>
        <button id="adminDeleteData">Alle Daten löschen</button>
        <hr>
        <h2>Datensatz bearbeiten</h2>
        <form id="editForm">
          <input type="hidden" id="editId" name="id" />
          <div>
            <label for="editName">Name:</label>
            <input type="text" id="editName" name="name" />
          </div>
          <div>
            <label for="editDate">Datum:</label>
            <input type="date" id="editDate" name="date" />
          </div>
          <div>
            <label for="editStartTime">Arbeitsbeginn:</label>
            <input type="time" id="editStartTime" name="startTime" required />
          </div>
          <div>
            <label for="editEndTime">Arbeitsende:</label>
            <input type="time" id="editEndTime" name="endTime" required />
          </div>
          <div>
            <label for="editBreakTime">Pause (Minuten):</label>
            <input type="number" id="editBreakTime" name="breakTime" min="0" step="1" value="0" />
          </div>
          <div>
            <label for="editComment">Bemerkungen:</label>
            <input type="text" id="editComment" name="comment" />
          </div>
          <button type="button" onclick="saveChanges()">Änderungen Speichern</button>
        </form>
      </div>

      <!-- Tab: Mitarbeiterverwaltung -->
      <div id="tab-employees" class="tab-content hidden">
        <h2>Mitarbeiterverwaltung</h2>
        <h3>Aktuelle Mitarbeiter</h3>
        <ul id="employeeList"></ul>
        <hr>
        <form id="addEmployeeForm">
          <h3>Mitarbeiter hinzufügen</h3>
          <div>
            <label for="employeeName">Name:</label>
            <input type="text" id="employeeName" name="employeeName" required />
          </div>
          <div>
            <label for="mo_hours">Montag (Soll-Std.):</label>
            <input type="number" id="mo_hours" name="mo_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="di_hours">Dienstag (Soll-Std.):</label>
            <input type="number" id="di_hours" name="di_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="mi_hours">Mittwoch (Soll-Std.):</label>
            <input type="number" id="mi_hours" name="mi_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="do_hours">Donnerstag (Soll-Std.):</label>
            <input type="number" id="do_hours" name="do_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="fr_hours">Freitag (Soll-Std.):</label>
            <input type="number" id="fr_hours" name="fr_hours" step="0.1" value="0" />
          </div>
          <button type="submit">Mitarbeiter hinzufügen</button>
        </form>
        <form id="editEmployeeForm" class="hidden">
          <hr>
          <h3>Mitarbeiter bearbeiten</h3>
          <input type="hidden" id="editEmployeeId" name="id" />
          <div>
            <label for="editEmployeeName">Name:</label>
            <input type="text" id="editEmployeeName" name="name" required />
          </div>
          <div>
            <label for="editMoHours">Montag (Soll-Std.):</label>
            <input type="number" id="editMoHours" name="mo_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="editDiHours">Dienstag (Soll-Std.):</label>
            <input type="number" id="editDiHours" name="di_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="editMiHours">Mittwoch (Soll-Std.):</label>
            <input type="number" id="editMiHours" name="mi_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="editDoHours">Donnerstag (Soll-Std.):</label>
            <input type="number" id="editDoHours" name="do_hours" step="0.1" value="0" />
          </div>
          <div>
            <label for="editFrHours">Freitag (Soll-Std.):</label>
            <input type="number" id="editFrHours" name="fr_hours" step="0.1" value="0" />
          </div>
          <button type="button" onclick="saveEmployeeChanges()">Mitarbeiter Speichern</button>
          <button type="button" onclick="cancelEdit()">Abbrechen</button>
        </form>
      </div>

      <!-- Tab: Monatsauswertung -->
      <div id="tab-monthly" class="tab-content hidden">
        <h2>Monatsauswertung</h2>
        <form id="monthlyBalanceForm">
          <div>
            <label for="balanceName">Mitarbeitername:</label>
            <input type="text" id="balanceName" name="balanceName" placeholder="z.B. Birte" required />
          </div>
          <div>
            <label for="balanceYear">Jahr:</label>
            <input type="number" id="balanceYear" name="balanceYear" placeholder="z.B. 2025" required />
          </div>
          <div>
            <label for="balanceMonth">Monat:</label>
            <input type="number" id="balanceMonth" name="balanceMonth" placeholder="z.B. 4" required min="1" max="12" />
          </div>
          <button type="submit">Monatsabschluss berechnen</button>
        </form>
        <p id="monthlyBalanceResult"></p>
      </div>
    </div>
  </div>
  <script>
    // Tab-Wechsel-Funktionalität
    document.querySelectorAll(".tabs li").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tabs li").forEach(t => t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(tc => tc.classList.add("hidden"));
        tab.classList.add("active");
        const target = tab.getAttribute("data-tab");
        document.getElementById("tab-" + target).classList.remove("hidden");
      });
    });

    // Admin-Login: Nach erfolgreichem Login wird der tab-basierte Bereich angezeigt
    document.getElementById("adminLoginForm").addEventListener("submit", async function(event) {
      event.preventDefault();
      const password = document.getElementById("adminPassword").value;
      try {
        const response = await fetch("/admin-login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ password })
        });
        const result = await response.text();
        if (response.ok) {
          alert("Admin erfolgreich angemeldet.");
          // Tab-basierten Bereich anzeigen und Login-Formular ausblenden
          document.getElementById("adminTabs").classList.remove("hidden");
          document.getElementById("adminLoginForm").classList.add("hidden");
          // Hier können weitere Admin-Daten geladen werden (z.B. loadAdminWorkHours, loadEmployees)
        } else {
          alert("Login fehlgeschlagen: " + result);
        }
      } catch (error) {
        console.error("Fehler beim Admin-Login:", error);
        alert("Netzwerkfehler oder Server nicht erreichbar.");
      }
    });

    // Platzhalter und bestehende Funktionsdefinitionen (Zeiterfassung, CSV-Download, Mitarbeiterfunktionen, etc.)
    function resetWorkTimeForm() {
      document.getElementById("comment").value = "";
      document.getElementById("breakTime").value = "0";
      document.getElementById("breakTime").disabled = true;
      document.getElementById("comment").disabled = true;
      document.getElementById("workTimeBtn").textContent = "Arbeitsbeginn buchen";
      workTimeState = 0;
      currentEntryId = null;
      document.getElementById("date").value = "";
      document.getElementById("startTime").value = "";
      document.getElementById("endTime").value = "";
    }
    
    // Weitere Funktionen wie loadEmployeeOptions, loadWorkHours, loadAdminWorkHours, loadEmployees, saveChanges, deleteEntry,
    // editEmployee, saveEmployeeChanges, deleteEmployee, cancelEdit etc. werden analog der vorherigen Version eingefügt.
    
    // Initialisierung
    resetWorkTimeForm();
  </script>
</body>
</html>
